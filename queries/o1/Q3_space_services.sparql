PREFIX btb: <http://basetype.benchmark/ontology#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

# Q3: Space Services - What equipment serves this space?
# Parameter: $SPACE_ID - space to query for serving equipment
# Returns each (equipment, relationship) pair like SQL version
# Canonical: equipment_type is always "Equipment" (node type)

SELECT DISTINCT ?space_id ?space_name ?building_id ?equipment_id ?equipment_name ?equipment_type
WHERE {
  BIND(<http://basetype.benchmark/$SPACE_ID> AS ?space)

  ?space btb:id ?space_id ;
         btb:name ?space_name ;
         btb:building_id ?building_id .

  # Relationships with correct directions based on dataset schema:
  # - CONTAINS: Space -> contains -> Equipment (space contains equipment)
  # - SERVES: Equipment -> serves -> Space (equipment serves space)
  # - LOCATED_IN: Equipment -> locatedIn -> Space (equipment located in space)
  {
    ?space btb:contains ?eq .
    BIND("CONTAINS" AS ?relationship)
  } UNION {
    ?eq btb:serves ?space .
    BIND("SERVES" AS ?relationship)
  } UNION {
    ?eq btb:locatedIn ?space .
    BIND("LOCATED_IN" AS ?relationship)
  }

  ?eq rdf:type btb:Equipment ;
      btb:id ?equipment_id ;
      btb:name ?equipment_name .
  BIND("Equipment" AS ?equipment_type)
}
ORDER BY ?equipment_name
